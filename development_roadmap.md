# Futarigohan 開発ロードマップ

## 📍 現在のステータス

**Phase 2.3 (ルーム機能実装) 待ち**

- ✅ Phase 0: 環境構築・準備 - **完了**
- ✅ Phase 1: プロトタイプ開発 (1.1〜1.6) - **完了**
- ✅ Phase 2.1: Firebase無料枠のセットアップ - **完了**
- ✅ Phase 2.2: リアルタイム同期の実装 - **完了**
- ✅ Phase 4: 公開準備（前倒し） - **完了**
- ⏳ Phase 2.3: ユーザー管理機能 - **次のステップ**

## 開発方針

- **プロトタイプ**: 個人利用の範囲を想定
- **サーバー費用**: 極力費用をかけない（無料枠を最大限活用）
- **初期アプローチ**: ローカルストレージベースで動作するPWA → 必要に応じてFirebase無料枠へ移行

---

## Phase 0: 環境構築・準備 (3-5日) ✅ **完了**

### 0.1 開発環境のセットアップ
- [x] Node.js / npm のインストール確認
- [x] Git リポジトリの初期化
- [x] プロジェクトディレクトリ構造の作成
- [x] `.gitignore` の設定

### 0.2 技術スタックの決定とセットアップ
- [x] フロントエンドフレームワークの選択（React推奨）
  - [x] `Vite` でプロジェクト作成（React + TypeScript）
  - [ ] PWA対応の設定（Service Worker、Manifest）※将来実装
- [x] スワイプUIライブラリの選定とインストール
  - [x] `react-tinder-card` を採用
- [x] スタイリングライブラリの選定
  - [x] `Tailwind CSS` を採用

### 0.3 データ構造の設計
- [x] Recipe Card のJSONスキーマ定義
- [x] Session のJSONスキーマ定義
- [x] ローカルストレージ用のデータ管理クラス設計

---

## Phase 1: プロトタイプ開発 - コア機能実装 (2週間) ✅ **完了**

### 1.1 データセット作成 (2-3日) ✅
- [x] 料理データセット（JSON）の作成
  - [x] 初期レシピデータ（10品 + ジョーカー3品）を手動作成
  - [x] 各レシピに必要な情報を収集
    - [x] 料理名
    - [x] 画像URL（プレースホルダー）
    - [x] タグ（"15分", "定番", "肉料理"等）
    - [x] カテゴリ（main, side, joker等）
    - [x] 外部リンク（Google検索URL）
  - [x] JSONファイルとして保存（`src/data/recipes.json`）

### 1.2 UIコンポーネント開発 (3-4日) ✅
- [x] レイアウトコンポーネント
  - [x] ヘッダーコンポーネント（`App.tsx`）
  - [x] メインコンテナコンポーネント

- [x] レシピカードコンポーネント（`RecipeCard.tsx`）
  - [x] カードの基本デザイン（画像、タイトル、説明、タグ表示）
  - [x] グラデーションオーバーレイによる可読性向上
  - [x] レスポンシブ対応（モバイル・デスクトップ）

- [x] スワイプUI実装（`SwipeDeck.tsx`）
  - [x] 右スワイプ（Like）の実装
  - [x] 左スワイプ（Nope）の実装
  - [ ] ~~上スワイプ（Super Like）の実装~~ ※廃止（UIシンプル化）
  - [x] スワイプ時のアニメーション
  - [x] タッチイベントとマウスイベントの両対応
  - [x] 上下スワイプの無効化（`preventSwipe: ['up', 'down']`）

- [x] ボタンUI（スワイプ代替）
  - [x] Like ボタン（❤️）
  - [x] Nope ボタン（❌）

### 1.3 ローカルストレージ実装 (1-2日) ✅
- [x] ローカルストレージ管理ユーティリティの作成（`src/utils/storage.ts`）
  - [x] レシピデータの読み込み機能
  - [x] セッションデータの保存・読み込み機能
  - [x] スワイプ履歴の保存機能
- [x] データ永続化のテスト

### 1.4 セッション管理機能 (2-3日) ✅
- [x] セッション作成機能
  - [x] 固定セッションID（`demo-session-001`）を使用
  - [x] 10枚のレシピカードをランダム選択
  - [x] セッション状態の初期化
- [x] スワイプ処理ロジック
  - [x] スワイプ結果の記録（ユーザーID別）
  - [x] カードの進行状況管理
- [x] マッチング判定ロジック
  - [x] 双方のLikeを検出（`checkMatch`）
  - [x] マッチング成立時の処理（`MatchResult`コンポーネント）
- [x] セッション状態の表示
  - [x] ユーザー切り替え機能（User A / User B）
  - [x] マッチング成立時の表示（紙吹雪アニメーション付き）

### 1.5 デッドロック回避機能 (1日) ✅
- [x] ジョーカーカードの実装
  - [x] 外食・中食・冷凍食品のカテゴリ追加（3品）
  - [x] 10枚すべて不一致時のジョーカーカード表示
  - [x] ジョーカーカード選択時の処理
  - [x] 非同期プレイ対応（`WaitingState`コンポーネント）

### 1.6 基本UI/UX実装 (2-3日) ✅
- [x] マッチング成立時の演出
  - [x] アニメーション効果（`react-confetti`）
  - [x] 成功メッセージ表示（`MatchResult`コンポーネント）
- [x] ローディング状態の表示（`WaitingState`コンポーネント）
- [x] エラーハンドリング（Firebase初期化エラーの回避）
- [x] 基本的なスタイリング（Tailwind CSS）
- [x] モバイル最適化（`overscroll-behavior-y: none`, `touch-action`）

### 1.7 動作確認・テスト (1-2日)
- [ ] 1人で2役での動作確認
  - [ ] ブラウザのシークレットモードで2つのタブを開く
  - [ ] 各タブで異なる選択を行い、マッチングが正しく動作するか確認
- [ ] ローカルストレージの動作確認
- [ ] モバイルデバイスでの動作確認
- [ ] バグ修正

---

## Phase 2: リアルタイム同期機能（オプション・費用考慮） (1週間)

**注意**: このフェーズは、ローカルストレージ版で十分な場合はスキップ可能。個人利用で2台のデバイスが必要な場合のみ実装。

### 2.1 Firebase無料枠のセットアップ (1日) ✅
- [x] Firebase プロジェクトの作成
- [ ] Firebase Authentication の設定（匿名認証またはメール認証）※将来実装
- [x] Firestore Database の設定（無料枠内）
- [x] Firebase Hosting の設定（無料枠内）
- [x] 環境変数の設定（APIキー等、`import.meta.env.VITE_FIREBASE_*`）

### 2.2 リアルタイム同期の実装 (2-3日) ✅
- [x] Firestore へのデータ書き込み機能（`FirestoreService.ts`）
- [x] リアルタイムリスナーの実装（`onSnapshot`）
  - [x] 相手のスワイプ結果をリアルタイムで受信
  - [x] マッチング成立時の自動検出
- [x] オフライン対応（ローカルストレージとのフォールバック）
  - [x] `IRecipeService`インターフェースによる抽象化
  - [x] 環境変数に応じて`LocalStorageService`/`FirestoreService`を切り替え
- [x] 同期エラーハンドリング（`try-catch`、nullチェック）

### 2.3 ユーザー管理機能 (1-2日) ⏳ **次のステップ**
- [ ] ペアリング機能（2人のユーザーを紐付け）
  - [ ] ペアコード生成・共有機能
  - [ ] ペアコード入力によるペアリング
- [ ] ユーザー識別機能
- [ ] セッション管理の改善（固定セッションIDから動的セッションIDへ）

### 2.4 テスト・最適化 (1日)
- [ ] 2台のデバイスでの動作確認
- [ ] リアルタイム同期の動作確認
- [ ] Firebase無料枠の使用量確認
- [ ] パフォーマンス最適化

---

## Phase 3: ドッグフーディング & α版改善 (2週間)

### 3.1 実際の使用とフィードバック収集 (1週間)
- [ ] 自身のパートナーと実際に使用
- [ ] 使用中の問題点・改善点の記録
- [ ] UXの課題洗い出し

### 3.2 UI/UX改善 (1週間)
- [ ] 「決まった瞬間」の演出をリッチに
  - [ ] マッチング成立時のアニメーション強化
  - [ ] サウンド効果（オプション）
  - [ ] 視覚的フィードバックの改善
- [ ] カードデザインの改善
- [ ] 操作性の向上
- [ ] レスポンシブデザインの最適化

### 3.3 機能追加・改善 (随時)
- [ ] 通知機能（指定時刻の通知）
  - [ ] ブラウザ通知APIの実装
  - [ ] 通知時刻の設定機能
- [ ] 過去のマッチング履歴表示
- [ ] レシピデータの拡充（50品 → 100品程度）

---

## Phase 4: 公開準備（オプション） (1ヶ月) ✅ **前倒しで完了**

### 4.1 デプロイ準備 ✅
- [x] プロダクション環境の構築（`npm run build`）
- [ ] ドメイン取得（オプション）※将来実装
- [x] SSL証明書の設定（Firebase Hostingで自動対応）
- [ ] デプロイ自動化（GitHub Actions等）※将来実装

### 4.2 ストア公開準備（モバイルアプリの場合）
- [ ] iOS App Store 公開準備 ※将来実装
  - [ ] Apple Developer アカウント登録
  - [ ] アプリアイコン・スクリーンショット作成
  - [ ] アプリ説明文の作成
- [ ] Google Play Store 公開準備 ※将来実装
  - [ ] Google Play Console アカウント登録
  - [ ] アプリアイコン・スクリーンショット作成
  - [ ] アプリ説明文の作成

### 4.3 Webアプリ公開（PWAの場合） ✅
- [x] Firebase Hosting へのデプロイ準備（`firebase.json`作成）
- [ ] PWAの動作確認 ※将来実装（Service Worker、Manifest）
- [x] モバイルブラウザでの動作確認（基本動作）

### 4.4 マーケティング準備
- [ ] SNSアカウントの準備
- [ ] プロモーション用のスクリーンショット・動画作成
- [ ] プレスリリースの作成（オプション）

---

## 技術的な注意事項

### 費用を抑えるためのポイント

1. **ローカルストレージ優先**
   - Phase 1では完全にローカルストレージで動作
   - 2台のデバイスが必要な場合のみFirebaseを検討

2. **Firebase無料枠の活用**
   - Sparkプラン（無料）の制限内で運用
   - Firestore: 50,000読み取り/日、20,000書き込み/日
   - Storage: 5GB
   - Hosting: 10GB転送/月

3. **画像の扱い**
   - 初期はプレースホルダー画像を使用
   - 権利フリー画像は無料サービス（Unsplash, Pexels等）を活用
   - 画像はCDNではなく、アプリにバンドル（サイズに注意）

4. **外部APIの最小化**
   - レシピ詳細はGoogle検索リンクのみ
   - 外部API（レシピAPI等）は使用しない

### 開発時のベストプラクティス

- 各タスクは小さく分解して実装
- 定期的に動作確認を行う
- バージョン管理を適切に行う
- コメントを適切に記述

---

## タスク管理の推奨方法

各タスクは以下の形式で管理することを推奨：

```
- [ ] タスク名
  - 詳細な説明
  - 実装のポイント
  - 完了条件
```

完了したタスクは `[x]` に変更し、進捗を可視化する。

---

## 次のステップ

### 🎯 優先実装項目（Phase 2.3）

1. **ユーザー管理機能**
   - ペアコード生成・共有機能
   - ペアコード入力によるペアリング
   - セッション管理の改善（固定セッションIDから動的セッションIDへ）

2. **Firebase Authentication の導入**
   - 匿名認証またはメール認証の実装
   - ユーザー識別の改善

### 📋 将来実装項目

- PWA対応（Service Worker、Manifest）
- デプロイ自動化（GitHub Actions等）
- モバイルアプリ化（iOS/Android）
- 通知機能（指定時刻の通知）
- 過去のマッチング履歴表示
- レシピデータの拡充（10品 → 50〜100品程度）

---

**更新履歴**
- 2024年: Phase 0, Phase 1, Phase 2.1-2.2, Phase 4 完了を反映

